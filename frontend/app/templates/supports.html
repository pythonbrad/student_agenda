<div class="row"><hr size='#'></div>
<div class="row">
    <div class="container-fluid" id='block'>
        <div id="parent">
            <div class="row" onclick="$(this).parent().find('#child').fadeToggle();">
                <div class="col-3">
                    <i class="fas fa-4x fa-book text-primary"></i>
                </div>
                <div class="col">
                    <span>Course: {{code}}</span>
                    <h4>{{name}}</h4>
                </div>
            </div>
            <br>
            <div class="row" id='child' style="display: none;">
                <div class="card" style="width: 100%;">
                    <div class="card-body">
                        <b>Description:</b> {{description}}<br>
                        <b>Date of publication:</b> {{pub_date}}<br>
                        <b>Type:</b> {{category}}<br>
                        <b>Number of downloading:</b> <span class="text-primary">{{nb_downloading}}</span><br>
                        <button class="btn btn-primary btn-sm" onclick='App.vars.tmp.download({{id}})'>Download</button><br>
                    </div>
                    <div class="card-footer" {{admin_panel}}>
                        <button class="btn btn-warning btn-sm" onclick='App.views.update_asset({{id}})'>Update</button>
                        <button class="btn btn-danger btn-sm" onclick='App.views.delete_asset({{asset_pk}})'>Delete</button>
                    </div>
                </div>
            </div>
            <hr size="#">
        </div>
    </div>
</div>
<!-- We duplicate the data -->
<script type="text/javascript">
    App.views.splash(null, 'show');
    App.vars.tmp.$el = $('#block');
    App.vars.tmp.$html = App.vars.tmp.$el.html();
    if (App.models.assets.length) {
        App.vars.tmp.$el.empty();
        for (var i = 0; i < App.models.assets.length; i++) {
            // We verify if owner
            App.vars.tmp.owner = 0;
            for (var ii = 0; ii < App.models.timetables.length; ii++) {
                if (App.models.timetables[ii].owner.pk == App.models.user.pk) {
                    App.vars.tmp.owner = 1;
                    break;
                };
            };
            App.vars.tmp.$el.append(App.vars.tmp.$html
                .replace('{{code}}', App.models.assets[i].course.code)
                .replace('{{name}}', App.models.assets[i].name)
                .replace('{{description}}', App.models.assets[i].description)
                .replace('{{pub_date}}', App.models.assets[i].pub_date)
                .replace('{{category}}', App.models.assets[i].category.name)
                .replace('{{nb_downloading}}', App.models.assets[i].readers)
                .replace('{{id}}', i)
                .replace('{{admin_panel}}', App.vars.tmp.owner ? '' : 'hidden')
                .replace('{{id}}', i)
                .replace('{{asset_pk}}', App.models.assets[i].pk)
            );
        };
    } else {
        App.vars.tmp.$el[0].innerHTML = 'No supports for the moment.';
    };
    App.vars.tmp.download = function (id) {
        Addons.request('/api/user/timetable/asset/'+App.models.assets[id].pk+'/read', null, function (){});
        var win = window.open(App.models.assets[id].url, '_blank');
        if (win) {
            //Browser has allowed it to be opened
            win.focus();
        } else {
            //Browser has blocked it
            alert('Please allow popups for launch the downloading');
        };
    };
    App.views.splash(null, 'hide');
</script>